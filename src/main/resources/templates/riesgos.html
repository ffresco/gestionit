<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html xmlns="http://www.w3.org/1999/xhtml"      xmlns:th="http://www.thymeleaf.org">

<head><div th:replace="fragments ::app_head('titulo')"></div></head>


</head>
<body>
	<div class="container-fluid"> <!-- contenedor de pagina-->

		<div th:replace="fragments ::navbartop"></div> <!-- Menu superior --> 	

		<div id="result"  class="row"> <!-- fila contine menuj lateral 3 col,  principal 9 col -->
		<!---------------A partir de aca es el codigo unico de la pagina-------------------------->			

			<div class="col-sm-3 sidenav">
				<div th:replace="fragments ::navbarside_riesgos"></div> <!-- Menu Lateral  -->  
			</div>
			<!-- Contenido principal 9 columnas -->
			<div class="col-sm-9">
<div class="spinner-border"></div>
				<div class="panel panel-default">
					<div class= "panel-heading row">

						<div class="col-sm-6"><h2>Riesgos</h2></div>
						<div class="col-sm-3"><a class="btn btn-sm btn-success" th:href="@{/riesgos/create}" >Nuevo</a></div>					
					</div>	
					<div class="panel-body row" ><!--dentro del panel body va mi contenido-->

						<table class="table table-responsive table-striped table-hover table-bordered">
							<thead class="bg-success">
								<tr>
									<th> CÃ³digo </th>
									<th> Responsable</th>
									<th> Fecha</th>
									<th> Origen</th>
									<th> Creador</th>
									<th> Auditor</th>
									<th> </th>										
									<!--<th> Mnd Base</th>-->
									<th></th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="riesgo : ${riesgos}">
									<td th:text="${riesgo.id}"></td>
									<td th:text="${riesgo.responsable}"></td>
									<td th:text="${#temporals.format(riesgo.fechaAnalisis, 'dd/MM/yyyy')}"></td>
									<td th:text="${riesgo.amenaza?.origen?.origen}"></td>
									<td th:text="${riesgo.usuarioCreador.email}"></td>
									<td th:text="${riesgo.usuarioAuditor?.email}"></td>
		
									<td>
										<div class="btn-group pull-right">
											<a class="btn btn-sm btn-primary" th:href="@{/riesgos/audit/{id}(id=${riesgo.id})}" >Auditoria</a>
											<span th:if="${riesgo.usuarioAuditor == null && searchDTO.currentUser.email == riesgo.usuarioCreador.email }">
												<a class="btn btn-sm btn-primary" th:href="@{/riesgos/edit/{id}(id=${riesgo.id})}" >Editar</a>
											</span>
											<span th:if="${searchDTO.onlyOneUser || (riesgo.usuarioAuditor == null && searchDTO.currentUser.email != riesgo.usuarioCreador.email) }"> 
 												<a class="btn btn-sm btn-primary" th:href="@{/riesgos/edit/{id}(id=${riesgo.id})}">Aprobar</a> 
											</span>	 
 											<span th:if="${riesgo.usuarioAuditor != null && riesgo.usuarioCreador !=null }"> 
 												<a class="btn btn-sm btn-primary" th:href="@{/riesgos/view/{id}(id=${riesgo.id})}">Ver</a> 
 											</span> 
 											<span th:if="${riesgo.usuarioAuditor == null }">
												<a class="delete btn btn-sm btn-danger" data-toggle="modal" data-target="#myModalRiesgo">borrar</a>
											</span>	
										</div>
											 <!-- The Modal -->
								                <div class="modal fade" id="myModalRiesgo">
								                    <div class="modal-dialog">
								                        <div class="modal-content">
								
								                            <!-- Modal Header -->
								                            <div class="modal-header">
								                                <h4 class="modal-title"  th:text="${'Esta seguro de eliminar el Riesgo ' + riesgo.id+'?'}" > </h4>
								                                <button type="button" class="close" data-dismiss="modal">&times;</button>
								                            </div>
								
								                            <!-- Modal footer -->
								                            <div class="modal-footer">
								                                <button type="button" class="btn btn-danger"
								                                    data-dismiss="modal">NO</button>
								                                <a th:href="@{/riesgos/delete/{id}(id=${riesgo.id})}"><button
								                                        type="button" class="btn btn-success">SI</button></a>
								                                   
								                            </div>
								                        </div>
								                    </div>
								                </div>
								                </form>
									</td>
								</tr>
							</tbody>
						</table>

					</div>
				</div>

			</div> <!-- Fin Contenido principal 9 columnas -->
           
        <!---------------Fin codigo unico de la pagina-------------------------->
		</div>	<!-- fila ROW contine menuj lateral 3 col,  principal 9 col -->
	<!-- fin contenedor de pagina-->

</body>
</html>
